<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{FORMULA_NAME}} - Homebrew Den</title>
  <meta name="description" content="Install {{FORMULA_NAME}} from the Homebrew Den tap.">
  <link rel="icon" type="image/svg+xml" href="../../favicon.svg">
  <link rel="stylesheet" href="../../output.css">
</head>
<body class="font-sans leading-relaxed">
  <!-- Nav -->
  <nav class="sticky top-0 z-100 bg-[var(--bg-alt)] border-b border-[var(--card-border)] backdrop-blur-md transition-[background,border-color] duration-200 ease-in-out">
    <div class="max-w-[960px] mx-auto px-6 h-15 flex items-center justify-between">
      <a href="../../" class="flex items-center gap-2.5 font-bold text-lg text-[var(--text)] no-underline">
        <svg class="w-7 h-7 text-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 8h1a4 4 0 1 1 0 8h-1"/>
          <path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/>
          <line x1="6" y1="2" x2="6" y2="4"/>
          <line x1="10" y1="2" x2="10" y2="4"/>
          <line x1="14" y1="2" x2="14" y2="4"/>
        </svg>
        Homebrew Den
      </a>
      <div class="flex items-center gap-2">
        <button class="flex items-center gap-2 h-9 px-3 border border-[var(--card-border)] rounded-sm bg-transparent text-[var(--text-muted)] cursor-pointer font-sans text-[0.85rem] transition-all duration-200 ease-in-out hover:text-accent hover:border-accent hover:bg-accent-subtle max-sm:w-9 max-sm:px-0 max-sm:justify-center" id="search-trigger" aria-label="Search packages">
          <svg class="w-4 h-4 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"/>
            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
          </svg>
          <span class="max-sm:hidden">Search packages...</span>
          <kbd class="font-sans text-[0.7rem] px-1.5 py-0.5 border border-[var(--card-border)] rounded-[3px] bg-[var(--code-bg)] text-[var(--text-muted)] leading-none max-sm:hidden" id="search-kbd"></kbd>
        </button>
        <button class="flex items-center justify-center w-9 h-9 border border-[var(--card-border)] rounded-sm bg-transparent text-[var(--text-muted)] cursor-pointer transition-all duration-200 ease-in-out hover:text-accent hover:border-accent hover:bg-accent-subtle" id="theme-toggle" aria-label="Toggle theme">
          <svg class="icon-sun w-[18px] h-[18px]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </svg>
          <svg class="icon-moon w-[18px] h-[18px]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
        <a href="https://github.com/mrdemonwolf/homebrew-den" class="flex items-center justify-center w-9 h-9 border border-[var(--card-border)] rounded-sm bg-transparent text-[var(--text-muted)] cursor-pointer transition-all duration-200 ease-in-out hover:text-accent hover:border-accent hover:bg-accent-subtle" aria-label="View on GitHub" target="_blank" rel="noopener noreferrer">
          <svg class="w-[18px] h-[18px]" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/>
          </svg>
        </a>
      </div>
    </div>
  </nav>

  <!-- Search Modal -->
  <div class="fixed inset-0 z-200 flex items-start justify-center pt-[15vh] bg-[var(--overlay-bg)] backdrop-blur-sm animate-fade-in hidden" id="search-overlay">
    <div class="w-full max-w-[560px] bg-[var(--card-bg)] border border-[var(--card-border)] rounded-lg shadow-[0_16px_48px_rgba(0,0,0,0.3)] overflow-hidden animate-slide-up max-sm:mx-4">
      <div class="flex items-center gap-3 p-4 border-b border-[var(--card-border)]">
        <svg class="w-5 h-5 text-[var(--text-muted)] shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"/>
          <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <input type="text" class="flex-1 border-none outline-none bg-transparent text-[var(--text)] font-sans text-base placeholder:text-[var(--text-muted)]" id="search-input" placeholder="Search formulae and casks..." autocomplete="off" spellcheck="false">
        <kbd class="font-sans text-[0.65rem] px-1.5 py-[3px] border border-[var(--card-border)] rounded-[3px] bg-[var(--code-bg)] text-[var(--text-muted)] leading-none uppercase tracking-wide">esc</kbd>
      </div>
      <div class="max-h-[340px] overflow-y-auto" id="search-results">
        <div class="py-8 px-4 text-center text-[var(--text-muted)] text-[0.9rem]">Type to search packages...</div>
      </div>
      <div class="flex items-center gap-4 px-4 py-2.5 border-t border-[var(--card-border)] bg-[var(--code-bg)] text-[0.75rem] text-[var(--text-muted)]">
        <span><kbd class="inline-block font-sans text-[0.65rem] px-[5px] py-[1px] border border-[var(--card-border)] rounded-[3px] bg-[var(--card-bg)] text-[var(--text-muted)] mx-0.5">&uarr;</kbd><kbd class="inline-block font-sans text-[0.65rem] px-[5px] py-[1px] border border-[var(--card-border)] rounded-[3px] bg-[var(--card-bg)] text-[var(--text-muted)] mx-0.5">&darr;</kbd> navigate</span>
        <span><kbd class="inline-block font-sans text-[0.65rem] px-[5px] py-[1px] border border-[var(--card-border)] rounded-[3px] bg-[var(--card-bg)] text-[var(--text-muted)] mx-0.5">&crarr;</kbd> open</span>
        <span><kbd class="inline-block font-sans text-[0.65rem] px-[5px] py-[1px] border border-[var(--card-border)] rounded-[3px] bg-[var(--card-bg)] text-[var(--text-muted)] mx-0.5">esc</kbd> close</span>
      </div>
    </div>
  </div>

  <!-- Breadcrumb -->
  <div class="border-b border-[var(--card-border)] bg-[var(--bg-alt)] transition-all duration-200 ease-in-out">
    <div class="max-w-[960px] mx-auto px-6 py-3 text-[0.85rem] flex items-center gap-1.5">
      <a href="../../" class="text-[var(--text-muted)] hover:text-accent">Home</a>
      <span class="text-[var(--text-muted)]">/</span>
      <a href="../../#formulae-section" class="text-[var(--text-muted)] hover:text-accent">Formulae</a>
      <span class="text-[var(--text-muted)]">/</span>
      <span class="text-[var(--text)] font-semibold" id="breadcrumb-name">{{FORMULA_NAME}}</span>
    </div>
  </div>

  <!-- Formula Detail -->
  <main class="max-w-[960px] mx-auto py-16 px-6 pt-12 max-sm:py-10 max-sm:px-4">
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-2 flex-wrap">
        <h1 class="text-[2rem] font-extrabold tracking-tight max-sm:text-[1.5rem]" id="formula-name"></h1>
        <span class="font-mono text-[0.85rem] bg-accent-subtle text-accent px-2 py-0.5 rounded-xl whitespace-nowrap" id="formula-version"></span>
        <span id="formula-stability-badge"></span>
      </div>
      <p class="text-[var(--text-muted)] text-[1.1rem]" id="formula-desc"></p>
    </div>

    <!-- Install Command -->
    <div class="bg-[var(--card-bg)] border border-[var(--card-border)] rounded-md p-6 mb-5 transition-all duration-200 ease-in-out">
      <h2 class="text-[0.8rem] font-semibold mb-4 uppercase tracking-widest text-[var(--text-muted)]">Install</h2>
      <div class="inline-flex items-center gap-3 bg-[var(--code-bg)] border border-[var(--code-border)] rounded-md px-5 py-3.5 font-mono text-[0.95rem] text-[var(--text)] w-full shadow-none">
        <code id="install-command"></code>
        <button class="copy-btn flex items-center justify-center w-8 h-8 border-none rounded-sm bg-accent text-white cursor-pointer transition-all duration-200 ease-in-out hover:bg-accent-hover hover:scale-105 shrink-0 ml-auto" onclick="copyText('install-command', this)" aria-label="Copy install command">
          <svg class="icon-copy w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
          </svg>
          <svg class="icon-check w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Details -->
    <div class="bg-[var(--card-bg)] border border-[var(--card-border)] rounded-md p-6 mb-5 transition-all duration-200 ease-in-out">
      <h2 class="text-[0.8rem] font-semibold mb-4 uppercase tracking-widest text-[var(--text-muted)]">Details</h2>
      <dl class="grid gap-0">
        <div class="flex items-baseline py-2.5 border-b border-[var(--card-border)] first:pt-0 last:border-b-0 last:pb-0 max-sm:flex-col max-sm:gap-0.5">
          <dt class="w-[120px] shrink-0 text-[0.85rem] font-semibold text-[var(--text-muted)] max-sm:w-auto">Homepage</dt>
          <dd class="text-[0.9rem]"><a id="formula-homepage" href="" target="_blank" rel="noopener noreferrer"></a></dd>
        </div>
        <div class="flex items-baseline py-2.5 border-b border-[var(--card-border)] first:pt-0 last:border-b-0 last:pb-0 max-sm:flex-col max-sm:gap-0.5">
          <dt class="w-[120px] shrink-0 text-[0.85rem] font-semibold text-[var(--text-muted)] max-sm:w-auto">License</dt>
          <dd class="text-[0.9rem]" id="formula-license"></dd>
        </div>
        <div class="flex items-baseline py-2.5 border-b border-[var(--card-border)] first:pt-0 last:border-b-0 last:pb-0 max-sm:flex-col max-sm:gap-0.5">
          <dt class="w-[120px] shrink-0 text-[0.85rem] font-semibold text-[var(--text-muted)] max-sm:w-auto">Version</dt>
          <dd class="text-[0.9rem]" id="formula-version-detail"></dd>
        </div>
        <div class="flex items-baseline py-2.5 border-b border-[var(--card-border)] first:pt-0 last:border-b-0 last:pb-0 max-sm:flex-col max-sm:gap-0.5" id="stability-row">
          <dt class="w-[120px] shrink-0 text-[0.85rem] font-semibold text-[var(--text-muted)] max-sm:w-auto">Stability</dt>
          <dd class="text-[0.9rem]" id="formula-stability-detail"></dd>
        </div>
      </dl>
    </div>

    <!-- Caveats -->
    <div class="bg-[var(--card-bg)] border border-[var(--card-border)] rounded-md p-6 mb-5 transition-all duration-200 ease-in-out hidden" id="caveats-card">
      <h2 class="text-[0.8rem] font-semibold mb-4 uppercase tracking-widest text-[var(--text-muted)]">Caveats</h2>
      <pre class="bg-[var(--code-bg)] border border-[var(--code-border)] rounded-sm p-4 font-mono text-[0.85rem] text-[var(--text)] whitespace-pre-wrap break-words leading-normal overflow-x-auto" id="formula-caveats"></pre>
    </div>

    <!-- Version History -->
    <div class="bg-[var(--card-bg)] border border-[var(--card-border)] rounded-md p-6 mb-5 transition-all duration-200 ease-in-out hidden" id="versions-card">
      <h2 class="text-[0.8rem] font-semibold mb-4 uppercase tracking-widest text-[var(--text-muted)]">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 6px;">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
        Version History
      </h2>
      <div class="table-wrap bg-[var(--card-bg)] border border-[var(--card-border)] rounded-md overflow-hidden shadow-[var(--shadow)] transition-all duration-200 ease-in-out max-sm:rounded-none max-sm:border-x-0">
        <table>
          <thead>
            <tr>
              <th>Version</th>
              <th>Date</th>
              <th>Status</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="versions-body"></tbody>
        </table>
      </div>
    </div>

    <!-- README -->
    <div class="bg-[var(--card-bg)] border border-[var(--card-border)] rounded-md p-6 mb-5 transition-all duration-200 ease-in-out" id="readme-card">
      <h2 class="text-[0.8rem] font-semibold mb-4 uppercase tracking-widest text-[var(--text-muted)]">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 6px;">
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
        </svg>
        README
      </h2>
      <div class="readme-content" id="readme-content">{{README_HTML}}</div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="border-t border-[var(--card-border)] py-8 px-6 text-center text-[var(--text-muted)] text-[0.85rem] transition-[border-color] duration-200 ease-in-out">
    <div class="max-w-[960px] mx-auto flex items-center justify-center gap-2 flex-wrap">
      <span>MIT License</span>
      <span class="text-[var(--card-border)]">&middot;</span>
      <span>&copy; 2026 <a href="https://www.mrdemonwolf.com" class="text-[var(--text-muted)] transition-colors duration-200 ease-in-out hover:text-accent" target="_blank" rel="noopener noreferrer">MrDemonWolf, Inc.</a></span>
      <span class="text-[var(--card-border)]">&middot;</span>
      <a href="https://github.com/mrdemonwolf/homebrew-den" class="text-[var(--text-muted)] transition-colors duration-200 ease-in-out hover:text-accent" target="_blank" rel="noopener noreferrer">GitHub</a>
    </div>
  </footer>

  <script>
    // --- Formula data injected at build time ---
    const formula = {{FORMULA_JSON}};
    const data = {{PACKAGES_JSON}};

    // --- Populate page ---
    document.getElementById('formula-name').textContent = formula.name;
    document.getElementById('formula-version').textContent = 'v' + formula.version;
    document.getElementById('formula-desc').textContent = formula.desc;
    document.getElementById('install-command').textContent = 'brew install ' + formula.name;
    document.getElementById('formula-homepage').textContent = formula.homepage;
    document.getElementById('formula-homepage').href = formula.homepage;
    document.getElementById('formula-license').textContent = formula.license || 'N/A';
    document.getElementById('formula-version-detail').textContent = formula.version;

    // Stability badge
    const stabilityLabels = { alpha: 'Alpha', beta: 'Beta', rc: 'Release Candidate', 'pre-release': 'Pre-release', stable: 'Stable' };
    const stability = formula.stability || 'stable';
    const stabilityLabel = stabilityLabels[stability] || stability;

    if (stability !== 'stable') {
      document.getElementById('formula-stability-badge').innerHTML =
        '<span class="stability-badge stability-' + stability + '">' + stabilityLabel + '</span>';
      document.getElementById('formula-stability-detail').innerHTML =
        '<span class="stability-badge stability-' + stability + '">' + stabilityLabel + '</span>' +
        '<span class="stability-hint"> &mdash; This version is not yet considered stable.</span>';
    } else {
      document.getElementById('formula-stability-detail').innerHTML =
        '<span class="stability-badge stability-stable">Stable</span>';
    }

    if (formula.caveats) {
      document.getElementById('caveats-card').classList.remove('hidden');
      document.getElementById('formula-caveats').textContent = formula.caveats;
    }

    // Version history
    if (formula.versions && formula.versions.length > 0) {
      document.getElementById('versions-card').classList.remove('hidden');
      const vtbody = document.getElementById('versions-body');
      vtbody.innerHTML = formula.versions.map(v => {
        const isCurrent = v.version === formula.version;
        const statusBadge = v.prerelease
          ? '<span class="stability-badge stability-pre-release">Pre-release</span>'
          : '<span class="stability-badge stability-stable">Stable</span>';
        const currentTag = isCurrent ? ' <span class="stability-badge stability-current">Current</span>' : '';
        return '<tr' + (isCurrent ? ' class="version-current"' : '') + '>' +
          '<td data-label="Version"><span class="font-mono text-[0.8rem] bg-accent-subtle text-accent px-2 py-0.5 rounded-xl whitespace-nowrap">v' + v.version + '</span>' + currentTag + '</td>' +
          '<td data-label="Date">' + v.date + '</td>' +
          '<td data-label="Status">' + statusBadge + '</td>' +
          '<td data-label=""><a href="' + v.url + '" target="_blank" rel="noopener noreferrer" class="version-link">Release notes</a></td>' +
          '</tr>';
      }).join('');
    }

    // Hide README card if empty
    const readmeContent = document.getElementById('readme-content');
    if (!readmeContent.innerHTML.trim()) {
      document.getElementById('readme-card').classList.add('hidden');
    }

    // --- Copy function ---
    function copyText(elementId, btn) {
      const text = document.getElementById(elementId).textContent;
      navigator.clipboard.writeText(text).then(() => {
        btn.classList.add('copied');
        btn.querySelector('.icon-copy').style.display = 'none';
        btn.querySelector('.icon-check').style.display = 'block';
        setTimeout(() => {
          btn.classList.remove('copied');
          btn.querySelector('.icon-copy').style.display = '';
          btn.querySelector('.icon-check').style.display = 'none';
        }, 2000);
      });
    }

    // --- Theme toggle ---
    const themeToggle = document.getElementById('theme-toggle');
    const html = document.documentElement;

    function setTheme(theme) {
      if (theme === 'dark') {
        html.classList.add('dark');
      } else {
        html.classList.remove('dark');
      }
      localStorage.setItem('theme', theme);
      const sun = themeToggle.querySelector('.icon-sun');
      const moon = themeToggle.querySelector('.icon-moon');
      if (theme === 'dark') {
        sun.style.display = 'block';
        moon.style.display = 'none';
      } else {
        sun.style.display = 'none';
        moon.style.display = 'block';
      }
    }

    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      setTheme(savedTheme);
    } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
      setTheme('light');
    } else {
      setTheme('dark');
    }

    themeToggle.addEventListener('click', () => {
      const current = html.classList.contains('dark') ? 'dark' : 'light';
      setTheme(current === 'dark' ? 'light' : 'dark');
    });

    // --- Cmd+K Search ---
    const searchOverlay = document.getElementById('search-overlay');
    const searchInput = document.getElementById('search-input');
    const searchResults = document.getElementById('search-results');
    const searchTrigger = document.getElementById('search-trigger');
    let activeIndex = -1;

    const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
    document.getElementById('search-kbd').textContent = isMac ? '\u2318K' : 'Ctrl+K';

    function buildSearchIndex() {
      const items = [];
      (data.formulae || []).forEach(f => {
        items.push({ name: f.name, desc: f.desc, version: f.version, type: 'Formula', href: '../../formulae/' + f.name + '/' });
      });
      (data.casks || []).forEach(c => {
        items.push({ name: c.name, desc: c.desc, version: c.version, type: 'Cask', href: c.homepage });
      });
      return items;
    }

    const searchIndex = buildSearchIndex();

    function openSearch() {
      searchOverlay.classList.remove('hidden');
      searchInput.value = '';
      searchInput.focus();
      activeIndex = -1;
      renderSearchResults('');
      document.body.style.overflow = 'hidden';
    }

    function closeSearch() {
      searchOverlay.classList.add('hidden');
      document.body.style.overflow = '';
    }

    function renderSearchResults(query) {
      if (!query.trim()) {
        searchResults.innerHTML = '<div class="py-8 px-4 text-center text-[var(--text-muted)] text-[0.9rem]">Type to search packages...</div>';
        activeIndex = -1;
        return;
      }

      const q = query.toLowerCase();
      const matches = searchIndex.filter(item =>
        item.name.toLowerCase().includes(q) ||
        item.desc.toLowerCase().includes(q)
      );

      if (matches.length === 0) {
        searchResults.innerHTML = '<div class="py-8 px-4 text-center text-[var(--text-muted)] text-[0.9rem]">No packages found.</div>';
        activeIndex = -1;
        return;
      }

      searchResults.innerHTML = matches.map((item, i) => `
        <a href="${item.href}" class="search-result flex items-center justify-between px-4 py-3 text-[var(--text)] no-underline border-b border-[var(--card-border)] transition-[background] duration-200 ease-in-out cursor-pointer last:border-b-0 hover:bg-accent-subtle${i === activeIndex ? ' active' : ''}" data-index="${i}">
          <div class="flex flex-col gap-0.5 min-w-0">
            <span class="font-semibold text-accent text-[0.95rem]">${item.name}</span>
            <span class="text-[var(--text-muted)] text-[0.8rem] whitespace-nowrap overflow-hidden text-ellipsis">${item.desc}</span>
          </div>
          <div class="flex items-center gap-2 shrink-0 ml-4">
            <span class="text-[0.7rem] font-semibold uppercase tracking-wide px-2 py-0.5 rounded-xl bg-accent-subtle text-accent">${item.type}</span>
            <span class="font-mono text-[0.75rem] text-[var(--text-muted)]">v${item.version}</span>
          </div>
        </a>
      `).join('');
    }

    function navigateResults(direction) {
      const items = searchResults.querySelectorAll('.search-result');
      if (items.length === 0) return;
      activeIndex += direction;
      if (activeIndex < 0) activeIndex = items.length - 1;
      if (activeIndex >= items.length) activeIndex = 0;
      items.forEach((el, i) => el.classList.toggle('active', i === activeIndex));
      items[activeIndex].scrollIntoView({ block: 'nearest' });
    }

    function selectResult() {
      const items = searchResults.querySelectorAll('.search-result');
      if (activeIndex >= 0 && activeIndex < items.length) items[activeIndex].click();
    }

    document.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
        e.preventDefault();
        searchOverlay.classList.contains('hidden') ? openSearch() : closeSearch();
      }
      if (e.key === 'Escape' && !searchOverlay.classList.contains('hidden')) closeSearch();
    });

    searchInput.addEventListener('input', () => { activeIndex = -1; renderSearchResults(searchInput.value); });
    searchInput.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowDown') { e.preventDefault(); navigateResults(1); }
      if (e.key === 'ArrowUp') { e.preventDefault(); navigateResults(-1); }
      if (e.key === 'Enter') { e.preventDefault(); selectResult(); }
    });

    searchOverlay.addEventListener('click', (e) => { if (e.target === searchOverlay) closeSearch(); });
    searchTrigger.addEventListener('click', openSearch);
  </script>
</body>
</html>
